# AI 角色扮演网页架构设计文档

## 1. 项目概述
本项目是一个基于 **AI 大模型驱动** 的角色扮演网页应用，用户可以注册并选择自己感兴趣的虚拟角色（哈利波特、苏格拉底、语文老师、小明），与其进行文字和语音互动。

已实现的功能包括：
- 用户注册、登录、登出
- 基于角色的文字聊天
- 语音条聊天（支持 TTS 生成与播放）
- 翻译模块（发出描述后llm会翻译成指定的语言）

目标用户：年轻群体、轻社交人群、自学型学习者。
项目分工：  
- 前端：周佳颖  
- 后端：周佳颖

---

## 2. 系统架构设计

采用 **前后端分离** 架构：
- 前端：React + Umi Max（Ant Design 组件库，支持移动端适配）
- 后端：Spring Boot(3.5.6) + WebFlux（异步非阻塞，支持 WebClient 调用第三方 API）+ JDK 17
- 模型调用：七牛云代理的 DeepSeek 模型（文本对话）、七牛云 TTS 接口（语音合成）、七牛云 ASR 接口（语音转文字）
- 数据存储：MySQL(8.0.12)
- 部署：本地部署

### 架构图

[前端 WebApp] ←→ [后端服务 Spring Boot] ←→ [数据库 MySQL]
↕
[七牛云 LLM / TTS API]

---

## 3. 功能模块设计

### 3.1 用户模块
- 注册
- 登录 / JWT 认证
- 登出

### 3.2 聊天模块
- **文字聊天**
    - 用户选择角色，输入文本进行聊天
    - 后端调用 DeepSeek API 获取回复
    - 回复存储数据库（带时间戳、角色ID、用户ID、聊天内容）
- **语音条聊天**
    - 用户传入语音先调用ASR转成文本 → 文本调用七牛 TTS → 生成音频 URL
    - 前端播放语音条 UI（支持播放/暂停）

### 3.3 翻译模块
- 前端输入需要翻译的内容
- 后端调用 DeepSeek 翻译
- 返回翻译结果，会附带角色个性附带语言展示给用户

### 3.4 会话管理模块
- 支持多会话记录（类似 ChatGPT 新建对话）
- 消息与会话关联

---

## 4. 数据库设计（MySQL）

### 用户表 `user`
| 字段          | 类型         | 描述             |
|---------------|-------------|------------------|
| id            | bigint PK   | 用户ID           |
| username      | varchar(50) | 用户名           |
| password_hash | varchar(255)| 加密密码         |
| avatar_url    | varchar(255)| 头像地址         |
| created_at    | datetime    | 注册时间         |

### 角色表 `role`
| 字段     | 类型         | 描述           |
|----------|-------------|----------------|
| id       | bigint PK   | 角色ID         |
| name     | varchar(50) | 角色名称       |
| background     | text        | 角色描述       |
| avatar   | varchar(255)| 角色头像       |

### 会话表 `conversation`
| 字段        | 类型        | 描述            |
|-------------|------------|-----------------|
| id          | bigint PK  | 会话ID          |
| user_id     | bigint FK  | 用户ID          |
| role_id     | bigint FK  | 角色ID          |
| created_at  | datetime   | 创建时间        |

### 消息表 `message`
| 字段        | 类型         | 描述               |
|-------------|-------------|--------------------|
| id          | bigint PK   | 消息ID             |
| conv_id     | bigint FK   | 会话ID             |
| sender      | varchar(20) | 发送方(user/role)  |
| text        | text        | 文本消息           |
| audio_url   | varchar(255)| 语音消息URL(可空)  |
| created_at  | datetime    | 发送时间           |

---

## 5. 技术选型
- **前端**：React + Umi Max + Ant Design
- **后端**：Spring Boot + WebFlux + Spring Security (JWT)
- **数据库**：MySQL
- **第三方服务**：
    - 七牛云代理 DeepSeek → 文本生成
    - 七牛云 TTS → 语音生成
    - 七牛云 ASR → 语音转文字
- **部署**：本地部署

---

## 6. 接口设计

### 用户相关
- `POST /api/auth/register` → 注册
- `POST /api/auth/login` → 登录
- `POST /api/auth/logout` → 登出

### 角色相关
- `GET /api/roles/all` → 获取所有角色信息
- `GET /api/all/name` → 获取角色列表
- `GET /api/voice` → 获取音色列表


### 聊天相关
- `POST /api/chat/send` → 发送消息（文字）
- `POST /api/voice/send` → 发送消息（文字）
- `POST /api/createConversation` → 新建会话
- `GET /api/conversations/{id}/messages` → 获取历史消息
- `GET /api/conversations/{roleId}` → 获取历史消息


---

## 7. 安全与扩展性
- JWT 认证，接口鉴权
- 未来可拓展：
    - 实时语音通话
    - “记忆快照”功能
    - 角色市场（用户可上传/分享角色）  
